Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.install = install;
exports.installPackage = installPackage;

var _helper = require('./helper');

'use babel';
var FS = require('fs');
var Path = require('path');
var View = require('./view');

window.__sb_package_deps = window.__sb_package_deps || [];

function install(packageName) {
  var enablePackages = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

  if (!packageName) throw new Error('packageName is required');

  var packageDeps = atom.packages.getLoadedPackage(packageName).metadata['package-deps'] || [];
  var packagesToInstall = [];
  packageDeps.forEach(function (name) {
    if (__sb_package_deps.indexOf(name) === -1) {
      __sb_package_deps.push(name);
      if (!atom.packages.resolvePackagePath(name)) {
        packagesToInstall.push(name);
      } else if (!atom.packages.getActivePackage(name) && enablePackages) {
        atom.packages.enablePackage(name);
        atom.packages.activatePackage(name);
      }
    }
  });
  if (packagesToInstall.length) {
    return installPackage(packageName, packagesToInstall);
  } else return Promise.resolve();
}

function installPackage(packageName, packageNames) {
  var view = new View(packageName, packageNames);
  return view.createNotification().then(function () {
    return (0, _helper.installPackages)(packageNames, function (name) {
      view.markFinished();
      atom.packages.enablePackage(name);
      atom.packages.activatePackage(name);
    }, function (detail) {
      view.notification.dismiss();
      atom.notifications.addError('Error installing ' + packageName + ' dependencies', { detail: detail });
    });
  });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9kb290Ly5hdG9tL3BhY2thZ2VzL2xpbnRlci1wYWNrYWdlLWpzb24tdmFsaWRhdG9yL25vZGVfbW9kdWxlcy9hdG9tLXBhY2thZ2UtZGVwcy9saWIvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7c0JBSThCLFVBQVU7O0FBSnhDLFdBQVcsQ0FBQTtBQUNYLElBQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUN4QixJQUFNLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUE7QUFDNUIsSUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFBOztBQUc5QixNQUFNLENBQUMsaUJBQWlCLEdBQUcsTUFBTSxDQUFDLGlCQUFpQixJQUFJLEVBQUUsQ0FBQTs7QUFFbEQsU0FBUyxPQUFPLENBQUMsV0FBVyxFQUEwQjtNQUF4QixjQUFjLHlEQUFHLEtBQUs7O0FBQ3pELE1BQUksQ0FBQyxXQUFXLEVBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFBOztBQUU1RCxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLENBQUE7QUFDOUYsTUFBTSxpQkFBaUIsR0FBRyxFQUFFLENBQUE7QUFDNUIsYUFBVyxDQUFDLE9BQU8sQ0FBQyxVQUFTLElBQUksRUFBRTtBQUNqQyxRQUFJLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtBQUMxQyx1QkFBaUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDNUIsVUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDM0MseUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO09BQzdCLE1BQU0sSUFBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksY0FBYyxFQUFFO0FBQ2pFLFlBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ2pDLFlBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFBO09BQ3BDO0tBQ0Y7R0FDRixDQUFDLENBQUE7QUFDRixNQUFJLGlCQUFpQixDQUFDLE1BQU0sRUFBRTtBQUM1QixXQUFPLGNBQWMsQ0FBQyxXQUFXLEVBQUUsaUJBQWlCLENBQUMsQ0FBQTtHQUN0RCxNQUFNLE9BQU8sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFBO0NBQ2hDOztBQUVNLFNBQVMsY0FBYyxDQUFDLFdBQVcsRUFBRSxZQUFZLEVBQUU7QUFDeEQsTUFBTSxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFBO0FBQ2hELFNBQU8sSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUMsSUFBSSxDQUFDO1dBQ3BDLDZCQUFnQixZQUFZLEVBQUUsVUFBUyxJQUFJLEVBQUU7QUFDM0MsVUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO0FBQ25CLFVBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ2pDLFVBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFBO0tBQ3BDLEVBQUUsVUFBUyxNQUFNLEVBQUU7QUFDbEIsVUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQTtBQUMzQixVQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsdUJBQXFCLFdBQVcsb0JBQWlCLEVBQUMsTUFBTSxFQUFOLE1BQU0sRUFBQyxDQUFDLENBQUE7S0FDdEYsQ0FBQztHQUFBLENBQ0gsQ0FBQTtDQUNGIiwiZmlsZSI6Ii9Vc2Vycy9kb290Ly5hdG9tL3BhY2thZ2VzL2xpbnRlci1wYWNrYWdlLWpzb24tdmFsaWRhdG9yL25vZGVfbW9kdWxlcy9hdG9tLXBhY2thZ2UtZGVwcy9saWIvbWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnXG5jb25zdCBGUyA9IHJlcXVpcmUoJ2ZzJylcbmNvbnN0IFBhdGggPSByZXF1aXJlKCdwYXRoJylcbmNvbnN0IFZpZXcgPSByZXF1aXJlKCcuL3ZpZXcnKVxuaW1wb3J0IHtpbnN0YWxsUGFja2FnZXN9IGZyb20gJy4vaGVscGVyJ1xuXG53aW5kb3cuX19zYl9wYWNrYWdlX2RlcHMgPSB3aW5kb3cuX19zYl9wYWNrYWdlX2RlcHMgfHwgW11cblxuZXhwb3J0IGZ1bmN0aW9uIGluc3RhbGwocGFja2FnZU5hbWUsIGVuYWJsZVBhY2thZ2VzID0gZmFsc2UpIHtcbiAgaWYgKCFwYWNrYWdlTmFtZSkgdGhyb3cgbmV3IEVycm9yKCdwYWNrYWdlTmFtZSBpcyByZXF1aXJlZCcpXG5cbiAgY29uc3QgcGFja2FnZURlcHMgPSBhdG9tLnBhY2thZ2VzLmdldExvYWRlZFBhY2thZ2UocGFja2FnZU5hbWUpLm1ldGFkYXRhWydwYWNrYWdlLWRlcHMnXSB8fCBbXVxuICBjb25zdCBwYWNrYWdlc1RvSW5zdGFsbCA9IFtdXG4gIHBhY2thZ2VEZXBzLmZvckVhY2goZnVuY3Rpb24obmFtZSkge1xuICAgIGlmIChfX3NiX3BhY2thZ2VfZGVwcy5pbmRleE9mKG5hbWUpID09PSAtMSkge1xuICAgICAgX19zYl9wYWNrYWdlX2RlcHMucHVzaChuYW1lKVxuICAgICAgaWYgKCFhdG9tLnBhY2thZ2VzLnJlc29sdmVQYWNrYWdlUGF0aChuYW1lKSkge1xuICAgICAgICBwYWNrYWdlc1RvSW5zdGFsbC5wdXNoKG5hbWUpXG4gICAgICB9IGVsc2UgaWYoIWF0b20ucGFja2FnZXMuZ2V0QWN0aXZlUGFja2FnZShuYW1lKSAmJiBlbmFibGVQYWNrYWdlcykge1xuICAgICAgICBhdG9tLnBhY2thZ2VzLmVuYWJsZVBhY2thZ2UobmFtZSlcbiAgICAgICAgYXRvbS5wYWNrYWdlcy5hY3RpdmF0ZVBhY2thZ2UobmFtZSlcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIGlmIChwYWNrYWdlc1RvSW5zdGFsbC5sZW5ndGgpIHtcbiAgICByZXR1cm4gaW5zdGFsbFBhY2thZ2UocGFja2FnZU5hbWUsIHBhY2thZ2VzVG9JbnN0YWxsKVxuICB9IGVsc2UgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbnN0YWxsUGFja2FnZShwYWNrYWdlTmFtZSwgcGFja2FnZU5hbWVzKSB7XG4gIGNvbnN0IHZpZXcgPSBuZXcgVmlldyhwYWNrYWdlTmFtZSwgcGFja2FnZU5hbWVzKVxuICByZXR1cm4gdmlldy5jcmVhdGVOb3RpZmljYXRpb24oKS50aGVuKCgpID0+XG4gICAgaW5zdGFsbFBhY2thZ2VzKHBhY2thZ2VOYW1lcywgZnVuY3Rpb24obmFtZSkge1xuICAgICAgdmlldy5tYXJrRmluaXNoZWQoKVxuICAgICAgYXRvbS5wYWNrYWdlcy5lbmFibGVQYWNrYWdlKG5hbWUpXG4gICAgICBhdG9tLnBhY2thZ2VzLmFjdGl2YXRlUGFja2FnZShuYW1lKVxuICAgIH0sIGZ1bmN0aW9uKGRldGFpbCkge1xuICAgICAgdmlldy5ub3RpZmljYXRpb24uZGlzbWlzcygpXG4gICAgICBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkRXJyb3IoYEVycm9yIGluc3RhbGxpbmcgJHtwYWNrYWdlTmFtZX0gZGVwZW5kZW5jaWVzYCwge2RldGFpbH0pXG4gICAgfSlcbiAgKVxufVxuIl19
//# sourceURL=/Users/doot/.atom/packages/linter-package-json-validator/node_modules/atom-package-deps/lib/main.js
